// ==UserScript==
// @name         Aza'raan Full Font Override (Pacifico + Grammar Columns)
// @namespace    https://github.com/thetransgendertrex
// @version      4.0
// @description  Replaces "Pacifico" with "Azaraan" in Google Docs, Drive apps, and specific grammar table columns based on headers.
// @author       William Saville
// @match        https://docs.google.com/*
// @match        https://slides.google.com/*
// @match        https://sheets.google.com/*
// @match        https://forms.google.com/*
// @match        https://drive.google.com/*
// @match        https://drawings.google.com/*
// @grant        none
// ==/UserScript==

(function () {
  'use strict';

  const AZARAAN_FONT = "'Azaraan', cursive !important";
  const TARGET_HEADERS = [
    "Glyph", "Aza'raan Word", "Aza'raan", "Subj", "Obj", "Poss", "Reflexive",
    "example", "Example Root", "Example Result", "Plural Identity", "Subject",
    "Object", "Possessive", "Example(s)", "Time Format", "Aza'raan Hour", "Aza'raan Name"
  ];

  // Inject @font-face for Azaraan
  if (!document.getElementById("azaraan-font-face")) {
    const fontFace = document.createElement("style");
    fontFace.id = "azaraan-font-face";
    fontFace.textContent = `
      @font-face {
        font-family: 'Azaraan';
        src: url('https://raw.githubusercontent.com/thetransgendertrex/Azaraanlanguage/main/Aza%27raan%20Planet%20Language.ttf') format('truetype');
        font-display: swap;
      }
    `;
    document.head.appendChild(fontFace);
  }

  // Inject fallback CSS to replace Pacifico with Azaraan
  const style = document.createElement('style');
  style.textContent = `
    [style*="font-family:Pacifico"],
    span[style*="font-family:Pacifico"],
    .kix-lineview-content span[style*="Pacifico"],
    .texteditor-text-input[style*="font-family:Pacifico"],
    .punch-viewer-content span[style*="font-family:Pacifico"],
    .cell-input[style*="font-family:Pacifico"],
    .grid-container span[style*="font-family:Pacifico"],
    .drawing-view text[style*="font-family:Pacifico"],
    .kix-canvas-tile-content text[style*="font-family:Pacifico"],
    .quantumWizTextinputPaperinputInput[style*="font-family:Pacifico"],
    .freebirdFormviewerViewItemsItemItemTitle[style*="font-family:Pacifico"],
    .a-s-T[style*="font-family:Pacifico"],
    .a-s-fa-T[style*="font-family:Pacifico"],
    .docs-texteventtarget-font-PACIFICO,
    .docs-texteventtarget-font-Pacifico,
    [class*="font-Pacifico"],
    [class*="Font-Pacifico"],
    [class*="texteventtarget-font-Pacifico"],
    [aria-label*="Pacifico"] {
      font-family: 'Azaraan' !important;
      font-size: 2em !important;
      color: #70389c !important;
      font-style: normal !important;
      font-weight: normal !important;
      line-height: 1.2 !important;
    }

    *:not([style*="Pacifico"]):not(.docs-texteventtarget-font-Pacifico) {
      font-family: inherit !important;
    }
  `;
  document.head.appendChild(style);

  // Mutation observer for column overrides and dropdown label rename
  const observer = new MutationObserver(() => {
    // Force override all direct uses of Pacifico
    document.querySelectorAll('[style*="font-family: Pacifico"]').forEach(el => {
      el.style.fontFamily = AZARAAN_FONT;
    });

    // Force table column overrides by header label
    document.querySelectorAll("table").forEach(table => {
      const headers = Array.from(table.querySelectorAll("thead th"));
      headers.forEach((th, index) => {
        const headerText = th.textContent.trim().toLowerCase();
        if (TARGET_HEADERS.map(h => h.toLowerCase()).includes(headerText)) {
          table.querySelectorAll("tbody tr").forEach(row => {
            const cell = row.cells[index];
            if (cell) {
              cell.style.fontFamily = AZARAAN_FONT;
            }
          });
        }
      });
    });

    // Visually rename dropdown label
    document.querySelectorAll('[aria-label="Pacifico"]').forEach(el => {
      if (el.textContent !== "Azaraan") {
        el.textContent = "Azaraan";
      }
    });
  });

  observer.observe(document.body, {
    childList: true,
    subtree: true,
    attributes: true,
    characterData: true
  });
})();
